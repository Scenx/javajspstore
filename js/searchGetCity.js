/* suning.com 1434124557458 */var SEARCH=SEARCH||{};SEARCH.searchGetCity=function(t){function i(t){this.opts=t||{},this.uid=$(this.opts.uid)||$("#J_cityWrap"),this.defaultCity=this.opts.defaultCity||{mdmId:"100",name:"江苏",commerceId:"100",defaultCityMdmId:"1000173",countryId:"",pinyin:"huadong_jiangsu",state:0,sequence:14},this.done=this.opts.done||function(){},this.getCityIdFirst=this.opts.getCityIdFirst||function(){},this.firstFlag=this.opts.firstFlag||!1,this.distShowFlag=this.opts.distShowFlag||!1,this.provinceUrl=this.opts.provinceUrl||"/getProvinceList/jsonp.html",this.cityUrl=this.opts.cityUrl||"/getCityList/jsonp/",this.districtUrl=this.opts.districtUrl||"/getDistrictList/jsonp/",this.pos=this.opts.pos||{};var i={};this.get=function(t){return i[t]},this.set=function(t,e){i[t]=e}}var e=!1,o=!1,s=!1,a=!1,n=!1;i.prototype={init:function(){var t=this,i=t.uid;t.getAddressByDefault(t.getProvinceList),$(".J_getCity").on("click",function(){$("#J_sortWrap").addClass("sort-wrap-up"),$(this).addClass("cur").siblings().removeClass("cur");var t=$(this),e=$(window).height();return i.hasClass("city-wrap-up")?(t.parent("li").addClass("cur").siblings().removeClass("cur"),i.removeClass("city-wrap-up").css({height:e-i.offset().top}),i.find(".province-list").css({height:e-i.offset().top}),i.find(".city-list").css({height:e-i.offset().top}),$("html").addClass("sn-active"),$("body").css({height:e}),i.find("#J_provinceList").scrollTop(0),i.find("#J_provinceList").scrollTop(i.find("#J_provinceList .cur").position().top)):(i.addClass("city-wrap-up").css({height:0}),i.find(".province-list").css({height:0}),i.find(".city-list").css({height:0}),$("html").removeClass("sn-active"),$("body").removeAttr("style"),$(".result-wrap .mask").hide()),!1})},getAddressByDefault:function(t){var i=this;i.firstFlag?(n=!0,i.set("geoCity",i.defaultCity),t.call(i,i.defaultCity)):(n=!1,e=!0,o=!0,s=!0,SUI.load.require("geo",function(e){e(function(e){i.getCityIdFirst(function(o){i.defaultCity=o,i.set("geoCity",e.addressComponent),t.call(i,o)})})}))},getProvinceList:function(t){var i=this,o=i.uid,s=i.get("geoCity");a=i.get("geoCity").ipFlag||!1,i.set("provinceUrl",i.provinceUrl),$.ajax({type:"GET",url:i.get("provinceUrl"),cache:!0,async:!1,dataType:"json",success:function(a){for(var c=i.firstFlag?t.provinceName:s.province,r="<ul>",d=0;d<a.provinceList.length;d++)r+=a.provinceList[d].provinceName==c?'<li class="cur" data-meta=\''+JSON.stringify(a.provinceList[d])+'\'><a href="javascript:;">'+a.provinceList[d].provinceName+"</a></li>":"<li data-meta='"+JSON.stringify(a.provinceList[d])+'\'><a href="javascript:;">'+a.provinceList[d].provinceName+"</a></li>";if(r+="</ul>",o.find("#J_provinceList").append(r),o.find("#J_provinceList a").on("click",function(){var t=$(this).parent("li").eq(0),e=JSON.parse(t.attr("data-meta"));return t.addClass("cur").siblings().removeClass("cur"),i.getCityById(e,function(){}),!1}),e){e=!1;var l=JSON.parse(o.find("#J_provinceList .cur").eq(0).attr("data-meta"));i.getCityById(l,function(){})}n&&o.find("#J_provinceList li").each(function(){var e=$(this)[0];if(e.dataset.meta){var o=JSON.parse(e.dataset.meta);if(t.provinceCode==o.provinceCode)return o.cityNo=t.cityNo,$(this).addClass("cur"),i.distShowFlag&&(o.distNo=t.distNo),i.getCityById(o,function(){}),!1}})}})},getCityById:function(t,i){var e=this,s=e.uid;e.set("cityUrl",e.cityUrl+t.provinceCode+".html"),$.ajax({type:"GET",url:e.get("cityUrl"),cache:!0,async:!1,dataType:"json",success:function(c){var r;r=n?e.get("geoCity").cityName:e.get("geoCity").city;for(var d="<ul>",l=0;l<c.cityList.length;l++)d+=c.cityList[l].cityName==r?'<li class="cur" data-meta=\''+JSON.stringify(c.cityList[l])+'\'><a href="javascript:;">'+c.cityList[l].cityName+"</a></li>":"<li data-meta='"+JSON.stringify(c.cityList[l])+'\'><a href="javascript:;">'+c.cityList[l].cityName+"</a></li>";if(d+="</ul>",s.find("#J_cityList").empty(),s.find("#J_cityList").append(d),"10"==t.provinceCode||"20"==t.provinceCode||"30"==t.provinceCode||"320"==t.provinceCode){switch(t.provinceCode){case"10":t.cityNo="9017";break;case"20":t.cityNo="9264";break;case"30":t.cityNo="9281";break;case"320":t.cityNo="9325"}o?(o=!1,a||r==r.substring(0,r.length-1),s.find("#J_cityList").find("li").each(function(){if($(this).find("a").eq(0).html().indexOf(r)>=0){var i=JSON.parse($(this)[0].dataset.meta);e.distShowFlag&&e.getDistrictsById(i,function(){}),e.distShowFlag||e.done(t)}})):n?s.find("#J_cityList").find("li").each(function(){var i=$(this)[0];if(i.dataset.meta){var o=JSON.parse(i.dataset.meta);t.cityNo==o.cityNo&&($(".J_getCity").eq(0).html(o.cityName),$(this).addClass("cur"),e.distShowFlag&&e.getDistrictsById(o,function(){}),e.distShowFlag||e.done(t))}}):e.distShowFlag&&e.getDistrictsById(t,function(){})}else o?(o=!1,a||r==r.substring(0,r.length-1),s.find("#J_cityList").find("li").each(function(){if($(this).find("a").eq(0).html().indexOf(r)>=0){var i=JSON.parse($(this)[0].dataset.meta);t=i,e.distShowFlag&&e.getDistrictsById(t,function(){}),e.distShowFlag||e.done(t)}})):n&&s.find("#J_cityList").find("li").each(function(){var i=$(this)[0];if(i.dataset.meta){var o=JSON.parse(i.dataset.meta);t.cityNo==o.cityNo&&($(".J_getCity").eq(0).html(o.cityName),$(this).addClass("cur"),e.distShowFlag&&e.getDistrictsById(t,function(){}),e.distShowFlag||e.done(t))}});s.find("#J_cityList a").on("click",function(){var i=$(this).parent("li"),o=JSON.parse(i.eq(0).attr("data-meta"));t=o,i.addClass("cur").siblings().removeClass("cur"),e.distShowFlag?e.getDistrictsById(o,function(){}):(t.cityNo=o.cityNo,t.provinceCode=o.provinceCode,$(".J_getCity").eq(0).html(o.cityName),s.addClass("city-wrap-up").css({height:0}),$("html").removeClass("sn-active"),$("body").removeAttr("style")),e.distShowFlag||e.done(t)}),i()}})},getDistrictsById:function(){}},new i(t).init()},function(){function cityinit(t){var i=new Date;i.setTime(i.getTime()+432e5),SEARCH.searchGetCity({uid:"#J_cityWrap",defaultCity:t,firstFlag:!0,distShowFlag:!1,getCityIdFirst:function(t){var i={provinceName:"江苏",provinceCode:"100",cityNo:"9173",cityName:"南京",distNo:"11365",distName:"玄武区"};t(i)},done:function(t){setDefaultCityInfo(t,i),searcher.changeCity(t.cityNo)}})}function setDefaultCityInfo(t,i){$.cookie("cityId",t.cityNo,{path:"/",domain:".suning.com",expires:i}),$.cookie("provinceCode",t.provinceCode,{path:"/",domain:".suning.com",expires:i});try{(isIos()||isAndroid())&&window.SNNativeClient.changeCity&&window.SNNativeClient.changeCity(t.cityNo)}catch(e){}}function getDefaultCityInfo(callback){var defaultCity={};if(defaultCity.cityNo=$.cookie("cityId")||"9173",defaultCity.provinceCode=$.cookie("provinceCode")||"100",isIos())try{return window.SNNativeClient?void getCityInfoListener():void document.addEventListener("SNNativeClientReady",getCityInfoListener,!1)}catch(e){}else if(isAndroid())try{if(window.SNNativeClient.getCityInfo){var cityInfo=eval("("+window.SNNativeClient.getCityInfo()+")");return defaultCity.cityNo=cityInfo.cityCode||defaultCity.cityNo,defaultCity.provinceCode=cityInfo.provinceCode||defaultCity.provinceCode,void callback.call(self,defaultCity)}}catch(e){}callback.call(self,defaultCity)}function isIos(){return navigator.userAgent.match(/SNEBUY-APP;?/i)&&navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)}function isAndroid(){return navigator.userAgent.match(/SNEBUY-APP;?/i)&&navigator.userAgent.match(/android/i)}function goToDetail(t,i,e,o){if(("undefined"==typeof e||0==e)&&(e="0000000000"),isIos()){var s=i;window.SNNativeClient.routeToClientPage&&("6"==o?window.SNNativeClient.goToFamousBrandProductDetail(i,"0000000000"):window.SNNativeClient.routeToClientPage("1013",s))}else isAndroid()&&window.SNNativeClient.goToProductDetail&&("6"==o?window.SNNativeClient.goToProductDetail(i,"0000000000","6"):window.SNNativeClient.goToProductDetail(i,"","0"))}function getCityInfoListener(){window.SNNativeClient.getCityInfo&&window.SNNativeClient.getCityInfo(function(t){var i={};i.cityNo=t.cityCode||i.cityNo,i.provinceCode=t.provinceCode||i.provinceCode,cityinit.call(self,i)})}getDefaultCityInfo(cityinit)}();